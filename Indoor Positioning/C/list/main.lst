C51 COMPILER V9.59.0.0   MAIN                                                              04/24/2020 20:48:05 PAGE 1   


C51 COMPILER V9.59.0.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\list\main.obj
COMPILER INVOKED BY: D:\XX\MDK\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\list\main.lst)
                    - TABS(2) OBJECT(.\list\main.obj)

line level    source

   1          /******************************************************************************
   2            作者：神秘藏宝室
   3            店铺：ILoveMCU.taobao.com
   4            功能：
   5              LCD1602液晶显示
   6              若液晶看不清楚字，请旋转对比度调节的电位器到字清晰为止
   7          ******************************************************************************/
   8          #include "main.h"
   9          #include "delay.h"
  10          #include "lcd1602.h"
  11          #include "led.h"
  12          #include "adc.h"
  13          
  14          /*************  功能说明  **************
  15          
  16          本程序演示LED闪烁  
  17          
  18          
  19          ******************************************/
  20          
  21          /*************  本地常量声明  **************/
  22          
  23          
  24          /*************  本地变量声明  **************/
  25          u8  i;
  26          u16 j,text;
  27          u16 Bandgap;
  28          
  29          /*************  本地函数声明  **************/
  30          
  31          
  32          
  33          /*************  外部函数和变量声明 *****************/
  34          
  35          
  36          
  37          /******************** IO配置函数 **************************/
  38          void  GPIO_config(void)
  39          {
  40   1        P5M0 &= ~(1<<5);    //设置P5.5为准双向口
  41   1        P5M1 &= ~(1<<5);
  42   1      }
  43          
  44          
  45          
  46          
  47          
  48          
  49          /******************** 主函数 **************************/
  50          void main(void)
  51          {
  52   1        init();
  53   1        GPIO_config();
  54   1      
C51 COMPILER V9.59.0.0   MAIN                                                              04/24/2020 20:48:05 PAGE 2   

  55   1        Init_LCD1602();
  56   1        LCD1602_write_com(0x80);    //指针指向第1行第0个位置
  57   1        LCD1602_write_word("Welcome to use!");
  58   1      
  59   1        LCD1602_write_com(0x80+0x40); //指针指向第2行第0个位置
  60   1        LCD1602_write_word("HelloWorld!");
  61   1      
  62   1        delay_ms(200);
  63   1        
  64   1        while(1)
  65   1        {
  66   2          
  67   2          #if (Cal_MODE == 0)
  68   2            //=================== 只读1次ADC, 10bit ADC. 分辨率0.01V ===============================
  69   2              P1ASF = 0;
  70   2              Get_ADC10bitResult(0);  //改变P1ASF后先读一次并丢弃结果, 让内部的采样电容的电压等于输入值.
  71   2              Bandgap = Get_ADC10bitResult(0);  //读内部基准ADC, P1ASF=0, 读0通道
  72   2              P1ASF = 1<<3;
  73   2              j = Get_ADC10bitResult(3);  //读外部电压ADC
  74   2              j = (u16)((u32)j * 123 / Bandgap);  //计算外部电压, Bandgap为1.23V, 测电压分辨率0.01V
  75   2            #endif
  76   2            //==========================================================================
  77   2      
  78   2            //===== 连续读16次ADC 再平均计算. 分辨率0.01V =========
  79   2            #if (Cal_MODE == 1)
                      P1ASF = 0;
                      Get_ADC10bitResult(0);  //改变P1ASF后先读一次并丢弃结果, 让内部的采样电容的电压等于输入值.
                      for(j=0, i=0; i<16; i++)
                      {
                        j += Get_ADC10bitResult(0); //读内部基准ADC, P1ASF=0, 读0通道
                      }
                      Bandgap = j >> 4; //16次平均
                      P1ASF = ADC_P13;
                      for(j=0, i=0; i<16; i++)
                      {
                        j += Get_ADC10bitResult(3); //读外部电压ADC
                      }
                      j = j >> 4; //16次平均
                      j = (u16)((u32)j * 123 / Bandgap);  //计算外部电压, Bandgap为1.23V, 测电压分辨率0.01V
                    #endif
  95   2      
  96   2          LCD1602_write_com(0x80+0x40+13);  //指针指向第2行第13个位置
  97   2          LCD1602_write_data(j/100 + 0x30); //显示百位
  98   2          LCD1602_write_data(j%100/10 + 0x30);//显示十位
  99   2          LCD1602_write_data(j%10 + 0x30);  //显示个位
 100   2          delay_ms(1000);
 101   2        }
 102   1      }
 103          
 104          void Led_flash() interrupt 1
 105          {
 106   1        TH0 = (65536 - 10000) / 256;
 107   1        TL0 = (65535 - 10000) % 256;
 108   1        text++;
 109   1        if(text >= 50)
 110   1        {
 111   2          text = 0;
 112   2        temp = _crol_(temp,1);
 113   2        if(temp == 0x08)
 114   2          temp = 0x01;
 115   2        P1 = temp;
 116   2        }
C51 COMPILER V9.59.0.0   MAIN                                                              04/24/2020 20:48:05 PAGE 3   

 117   1      }
 118          
 119          void init()
 120          {
 121   1        P0M1 = 0; P0M0 = 0; //设置为准双向口
 122   1        P1M1 = 0; P1M0 = 0; //设置为准双向口
 123   1        P2M1 = 0; P2M0 = 0; //设置为准双向口
 124   1        P3M1 = 0; P3M0 = 0; //设置为准双向口
 125   1        P4M1 = 0; P4M0 = 0; //设置为准双向口
 126   1        P5M1 = 0; P5M0 = 0; //设置为准双向口
 127   1        P6M1 = 0; P6M0 = 0; //设置为准双向口
 128   1        P7M1 = 0; P7M0 = 0; //设置为准双向口
 129   1        P1M1 |= (1<<3);   // 把ADC口设置为高阻输入
 130   1        P1M0 &= ~(1<<3);
 131   1        P1ASF = (1<<3);   //P1.3做ADC
 132   1        ADC_CONTR = 0xE0; //90T, ADC power on
 133   1        
 134   1        AUXR = 0x00;
 135   1        TMOD = 0x01;
 136   1        TH0 = (65536 - 10000) / 256;
 137   1        TL0 = (65535 - 10000) % 256;
 138   1        EA = 1;
 139   1        ET0 = 1;
 140   1        TR0 = 1;
 141   1        temp = 0x01;
 142   1        text = 0;
 143   1      }
 144          
 145          
 146          
 147          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    332    ----
   CONSTANT SIZE    =     28    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      8    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
