C51 COMPILER V9.59.0.0   COLLECT                                                           04/27/2020 15:31:20 PAGE 1   


C51 COMPILER V9.59.0.0, COMPILATION OF MODULE COLLECT
OBJECT MODULE PLACED IN .\list\collect.obj
COMPILER INVOKED BY: D:\XX\MDK\C51\BIN\C51.EXE collect.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\list\collec
                    -t.lst) TABS(2) OBJECT(.\list\collect.obj)

line level    source

   1          #include "collect.h"
   2          
   3          u8  i;
   4          u16 j;  
   5          u16 Bandgap;
   6          
   7          //=================== 只读1次ADC, 10bit ADC. 分辨率0.01V ===============================
   8          #if (Cal_MODE == 0)
   9            u16 coll_data_1()
  10            {
  11   1          P1ASF = 0;
  12   1          Get_ADC10bitResult(0);  //改变P1ASF后先读一次并丢弃结果, 让内部的采样电容的电压等于输入值.
  13   1          Bandgap = Get_ADC10bitResult(0);  //读内部基准ADC, P1ASF=0, 读0通道
  14   1          P1ASF = 1<<3;
  15   1          j = Get_ADC10bitResult(3);  //读外部电压ADC
  16   1          j = (u16)((u32)j * 123 / Bandgap);  //计算外部电压, Bandgap为1.23V, 测电压分辨率0.01V
  17   1          return j;
  18   1        }
  19          #endif
  20          //==========================================================================
  21          
  22          //===== 连续读16次ADC 再平均计算. 分辨率0.01V =========
  23          #if (Cal_MODE == 1)
                u16 coll_data_2()
                {
                  P1ASF = 0;
                  Get_ADC10bitResult(0);  //改变P1ASF后先读一次并丢弃结果, 让内部的采样电容的电压等于输入值.
                  for(j=0, i=0; i<16; i++)
                  {
                    j += Get_ADC10bitResult(0); //读内部基准ADC, P1ASF=0, 读0通道
                  }
                  Bandgap = j >> 4; //16次平均
                  P1ASF = ADC_P13;
                  for(j=0, i=0; i<16; i++)
                  {
                    j += Get_ADC10bitResult(3); //读外部电压ADC
                  }
                  j = j >> 4; //16次平均
                  j = (u16)((u32)j * 123 / Bandgap);  //计算外部电压, Bandgap为1.23V, 测电压分辨率0.01V
                  return j;
                }
              #endif
  43                


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =     62    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      5    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.

C51 COMPILER V9.59.0.0   COLLECT                                                           04/27/2020 15:31:20 PAGE 2   


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
